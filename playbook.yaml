---
- name: hadoop-testing playbook

  hosts: local

  pre_tasks:
    - name: orchestrate env file
      ansible.builtin.template:
        src: templates/{{ item.file }}.j2
        dest: "{{ playbook_dir }}/.{{ item.file }}"
        mode: "{{ item.mode }}"
      with_items:
        - { file: "env", mode: "a+x" }

  tasks:
    - name: orchestrate download file
      ansible.builtin.template:
        src: templates/{{ item.file }}.j2
        dest: "{{ playbook_dir }}/{{ item.file }}"
        mode: "{{ item.mode }}"
      with_items:
        - { file: "download.sh", mode: "a+x" }

    - include_tasks: node-template.yaml
      loop:
        - name: "hadoop-master1"
          group: "hadoop-master"
        - name: "hadoop-worker1"
          group: "hadoop-worker"
        - name: "hadoop-worker2"
          group: "hadoop-worker"
        - name: "hadoop-worker3"
          group: "hadoop-worker"
      loop_control:
        loop_var: node

    - name: orchestrate compose file
      ansible.builtin.template:
        src: templates/compose.yaml.j2
        dest: "{{ playbook_dir }}/compose.yaml"
